// JavaScript Document
function search(event){
	
}
function play(event){
	var audio = document.getElementById("player");
	if(!$("#button-play").hasClass("pausetoplay")&&!$("#button-play").hasClass("playtopause"))
	{
		$("#button-play").addClass("playtopause");
		return;
	}
	if(audio.paused === true || audio.currentTime == 0){
		$("#button-play").addClass("playtopause");
		$("#button-play").removeClass("pausetoplay");
		return;
	}
	else{
		$("#button-play").removeClass("playtopause");
		$("#button-play").addClass("pausetoplay");
		return;
	}
}
function menuevent(event){
	if(!$("#sidebar").hasClass("menu-invisible")&&!$("#sidebar").hasClass("menu-visible")){
		$("#sidebar").addClass("menu-visible");
		$("header").addClass("move");
		$("#content").addClass("move");
		$("footer").addClass("move");
		//$("#button-menu").addClass("rotateZ");
		return;
	}
	if($("#sidebar").hasClass("menu-invisible")){
		$("#sidebar").removeClass("menu-invisible");
		$("#sidebar").addClass("menu-visible");	
		$("header").addClass("move");
		$("#content").addClass("move");
		$("footer").addClass("move");
		//$("#button-menu").addClass("rotateZ");
		//$("#button-menu").removeClass("rotateZback");
		$("header").removeClass("moveback");
		$("#content").removeClass("moveback");
		$("footer").removeClass("moveback");
		return;
	}
	if($("#sidebar").hasClass("menu-visible")){
		$("#sidebar").addClass("menu-invisible");
		$("#sidebar").removeClass("menu-visible");
		//$("#button-menu").removeClass("rotateZ");
		//$("#button-menu").addClass("rotateZback");
		$("header").removeClass("move");
		$("#content").removeClass("move");
		$("footer").removeClass("move");
		$("header").addClass("moveback");
		$("#content").addClass("moveback");
		$("footer").addClass("moveback");
		return;
	}
}
function playercontrol(event){
	var audio = document.getElementById("player");
	if(audio.paused === true || audio.currentTime == 0){
		if(audio.duration> 0)
		{
			return audio.play();
		}
		else{
			var rand = Math.floor((Math.random()*musiclist.length)+1);
			crntPlay = musiclist[rand];
			audio.setAttribute('src', musiclist[rand].url);
			return audio.play();
		}
	}
	else{
		return audio.pause();
	}
}
$(document).ready(function(){
	$("#button-menu").on("click", menuevent);
	$("#content").on("click", function(event){
		if($("#sidebar").hasClass("menu-visible")){
			menuevent();	
		}	
		if($(".search").hasClass("searchshow")){
			search();
		}
	});
	$("#button-play").on("click", play);
	$("#button-play").on("click", playercontrol);
});
var crntPlay;
var musiclist;
var result;
var app = angular.module("app",[]);
app.controller("load", function($scope, $http){
	$scope.loading=true;
	$http.get("https://skormusic.firebaseio.com/music.json").then(function(respone)
	{
		$scope.musics = respone.data;
		musiclist = Object.keys(respone.data).map(function(key)
		{
			return respone.data[key];
		});
	},
	function(err){	
		$scope.loading=true;
	})
	.finally(function(){
		$scope.loading = false;
	});
	$scope.choose = function($event, music){
		var audio = document.getElementById("player");
		audio.pause();
		audio.setAttribute('src', music.url);
		play(event);
		crntPlay = music;
		return audio.play();
	}
});
app.controller("musicCtrl", function($scope){
	$scope.previous = function($event){
		var audio = document.getElementById("player");
		for(var i in musiclist)
		{
			if(musiclist[i].url == crntPlay.url && i!="0")
			{
				audio.pause();
				audio.setAttribute('src', musiclist[--i].url);
				crntPlay = musiclist[i];
				play(event);
				return audio.play();;
			}
		}
		play(event);
		audio.play();
	}
	$scope.next = function($event){
		var audio = document.getElementById("player");
		for(var i in musiclist)
		{
			if(musiclist[i].url == crntPlay.url && i!=musiclist.length-1)
			{
				audio.pause();
				audio.setAttribute('src', musiclist[++i].url);
				crntPlay = musiclist[i];
				play(event);
				return audio.play();;
			}
		}
		play(event);
		audio.play();
	}
});

app.controller('search', function($scope){
	$scope.keyupsearch = function($event){
		var scan = $scope.string.toLowerCase();
		$scope.results = [];
		angular.forEach(musiclist, function(item){
            if(item.name.toLowerCase().indexOf(scan) !== -1){
            		$scope.results.push(item);
     		   }
        });
        return $scope.results;
	}
});

// xong result search, chỉ cần thêm div gần input search để đổ result xún là xong :D :v :V









	